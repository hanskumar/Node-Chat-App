<!doctype html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title> Chat </title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Responsive Bootstrap 4 Chat App" name="description" />
        <meta content="Themesbrand" name="author" />
        <!-- App favicon -->
        <link rel="shortcut icon" href="assets/images/favicon.ico">

        <!-- owl.carousel css -->
        <link rel="stylesheet" href="/assets/libs/owl.carousel/assets/owl.carousel.min.css">
        <link rel="stylesheet" href="/assets/libs/owl.carousel/assets/owl.theme.default.min.css">

        <!-- Bootstrap Css -->
        
        <link href="/assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css" />
        <!-- Icons Css -->
        <link href="/assets/css/icons.min.css" rel="stylesheet" type="text/css" />
        <!-- App Css-->
        
        <link href="/assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css" />

        <link rel="stylesheet" href="/assets/emoji/emojionearea.min.css">
        <script type="text/javascript" src="/assets/emoji/emojionearea.min.js"></script>


    </head>
    <body>

        <div class="layout-wrapper d-lg-flex">
            <!-- start chat-leftsidebar -->
            <div class="chat-leftsidebar mr-lg-1">

                <div class="tab-content">
                    <!-- Start chats tab-pane -->
                    <div class="tab-pane fade show active" id="pills-chat" role="tabpanel" aria-labelledby="pills-chat-tab">
                        <!-- Start chats content -->
                        <div>
                            <div class="px-4 pt-4">
                                <h4 class="mb-4"> <a href="/dashboard" > <%= session.name %> </a> <a class="dropdown-item" href="/logout"> <i class="ri-logout-circle-r-line float-right text-muted"></i></a> </h4>
                                
                                <div class="search-box chat-search-box">
                                    <div class="input-group mb-3 bg-light  input-group-lg rounded-lg">
                                        <div class="input-group-prepend">
                                            <button class="btn btn-link text-muted pr-1 text-decoration-none" type="button">
                                                <i class="ri-search-line search-icon font-size-18"></i>
                                            </button>
                                        </div>
                                        <input type="text" class="form-control bg-light" placeholder="Search messages or users">
                                    </div> 
                                </div> <!-- Search Box-->
                            </div> <!-- .p-4 -->
    
                            <!-- Start chat-message-list -->
                            <div class="px-2">
                                <div class="chat-message-list" data-simplebar>
                                    
                                    <input type="hidden" name="local_data" class="local_data" value="<%= JSON.stringify(session) %>">
            
                                    <!--------Leftside User----------->
                                    <ul class="list-unstyled chat-list chat-user-list">

                                    </ul>
                                </div>
                            </div>
                            <!-- End chat-message-list -->
                        </div>
                        <!-- Start chats content -->
                    </div>
                    <!-- End chats tab-pane -->
                </div>
                <!-- end tab content -->
            </div>
            <!-- end chat-leftsidebar -->

            <!-- Start User chat -->
            <div class="user-chat w-100 overflow-hidden">
                <div class="d-lg-flex">

                    <!-- start chat conversation section -->
                    <div class="w-100 overflow-hidden position-relative">
                        <div class="p-3 p-lg-4 border-bottom">
                            <div class="row align-items-center">
                                <div class="col-sm-4 col-8">
                                    <div class="media align-items-center">
                                        <div class="d-block d-lg-none mr-2">
                                            <a href="javascript: void(0);" class="user-chat-remove text-muted font-size-16 p-2"><i class="ri-arrow-left-s-line"></i></a>
                                        </div>
                                    <% if (data.users) { %>
                                            <% for (let usersInChat of data.users) { %>
                                            <div class="mr-3">
                                                <% if(!usersInChat.pofile_pic) { %>
                                                    <div class="avatar-xs"><span class="avatar-title rounded-circle bg-soft-primary text-primary">H</span></div>   
                                                <% } else {%>        
                                                <img src="<%=usersInChat.pofile_pic%>" class="rounded-circle avatar-xs" alt="">
                                                <% } %>
                                            </div>
                                                <div class="media-body overflow-hidden">
                                                    <h5 class="font-size-16 mb-0 text-truncate">
                                                    
                                                <a href="#" class="text-reset user-profile-show"><%= usersInChat.name%></a></br>
                                                <span class="loggedIn_status logged_in__<%=usersInChat._id%>" style="display:none;">Online</span>
                                                
                                                 
                                            </h5>
                                        </div>
                                        <% } }%>
                                    </div>
                                </div>
                                <div class="col-sm-8 col-4">
                                    <ul class="list-inline user-chat-nav text-right mb-0">
                                        
                                        <li class="list-inline-item">
                                            <div class="dropdown">
                                                <button class="btn nav-btn dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    <i class="ri-search-line"></i>
                                                </button>
                                                <div class="dropdown-menu p-0 dropdown-menu-right dropdown-menu-md">
                                                    <div class="search-box p-2">
                                                        <input type="text" class="form-control bg-light border-0" placeholder="Search..">
                                                    </div>
                                                </div>
                                            </div>
                                        </li>

                                        <li class="list-inline-item d-none d-lg-inline-block">
                                            <button type="button" class="btn nav-btn" data-toggle="modal" data-target="#audiocallModal">
                                                <i class="ri-phone-line"></i>
                                            </button>
                                        </li>

                                        <li class="list-inline-item d-none d-lg-inline-block">
                                            <button type="button" class="btn nav-btn" data-toggle="modal" data-target="#videocallModal">
                                                <i class="ri-vidicon-line"></i>
                                            </button>
                                        </li>
    
                                        <li class="list-inline-item d-none d-lg-inline-block">
                                            <button type="button" class="btn nav-btn user-profile-show">
                                                <i class="ri-user-2-line"></i>
                                            </button>
                                        </li>
    
                                        <li class="list-inline-item">
                                            <div class="dropdown">
                                                <button class="btn nav-btn dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    <i class="ri-more-fill"></i>
                                                </button>
                                                <div class="dropdown-menu dropdown-menu-right">
                                                    <a class="dropdown-item d-block d-lg-none user-profile-show" href="#">View profile <i class="ri-user-2-line float-right text-muted"></i></a>
                                                    <a class="dropdown-item d-block d-lg-none" href="#" data-toggle="modal" data-target="#audiocallModal">Audio <i class="ri-phone-line float-right text-muted"></i></a>
                                                    <a class="dropdown-item d-block d-lg-none" href="#">Video <i class="ri-vidicon-line float-right text-muted"></i></a>
                                                    <a class="dropdown-item" href="#">Archive <i class="ri-archive-line float-right text-muted"></i></a>
                                                    <a class="dropdown-item" href="#">Muted <i class="ri-volume-mute-line float-right text-muted"></i></a>
                                                    <a class="dropdown-item" href="#">Delete <i class="ri-delete-bin-line float-right text-muted"></i></a>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <!-- end chat user head -->
    
                        <!-- start chat conversation -->
                        <div class="chat-conversation p-3 p-lg-4" data-simplebar="init" >
                            <ul class="list-unstyled mb-0 chatContainer">
                                
                            <% if (message.length > 0) { %>
                                <% for (let msg of message) {  
                                    if(msg.sender._id.toString() == session._id.toString()){ %>

                                        <li class="right">
                                                <div class="conversation-list">
                                                
                                                <div class="user-chat-content">
                                                    <div class="ctext-wrap">
                                                        <div class="ctext-wrap-content">
                                                            <p class="mb-0"><%=msg.message%></p>
                                                            
                                                            <p class="chat-time mb-0"><i class="ri-time-line align-middle"></i> <span class="align-middle">10:02</span></p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </li>  

                                <% } else { %>

                                    <li>
                                        <div class="conversation-list">
                                            <div class="user-chat-content">
                                                <div class="ctext-wrap">
                                                    <div class="ctext-wrap-content">
                                                        <p class="mb-0"><%= msg.message%></p>
                                                        <p class="chat-time mb-0"><i class="ri-time-line align-middle"></i> <span class="align-middle">10:00</span></p>
                                                    </div>
                                                </div>
                                                <div class="conversation-name"><%= msg.sender.name%> </div>
                                            </div>
                                        </div>
                                    </li>
                                <% } %>     
                        <% } } %> 

                        <li class="typingDots" style="display:none;"></li>  
                          
                    </ul>
                        </div>
                        <!-- end chat conversation end -->
    
                        <!-- start chat input section -->
                        <div class="chat-input-section p-3 p-lg-4 border-top mb-0">
                            <div class="row no-gutters">
                                <div class="col">
                                    <div>
                                        <input type="text" class="form-control form-control-lg bg-light border-light typing_box" placeholder="Enter Message..." >
                                        <input type="hidden" class="chatID" value="<% if (data) { %> <%= data._id %> <% } %>" name="chatID" > 
                                    </div>
                                </div>

                                <div class="col-auto">
                                    <div class="chat-input-links ml-md-2" style="margin-top: 20px;">

                                        <ul class="list-inline mb-0" id="media_container">

                                            <li class="list-inline-item" data-toggle="tooltip" data-placement="top" title="Voice Recoder">
                                                <button type="button" class="btn btn-link text-decoration-none font-size-16 btn-lg waves-effect voice_recoder">
                                                    <i class="ri-mic-fill" aria-hidden="true" style="font-size: 32px;"></i>
                                                </button>
                                            </li>

                                            <li class="list-inline-item" data-toggle="tooltip" data-placement="top" title="Attached File">  
                                                    <!--<input type="file" name="media_attachment" class="btn btn-link text-decoration-none font-size-16 btn-lg waves-effect media_attachment">--->

                                                    <button type="button" class="btn btn-link text-decoration-none font-size-16 btn-lg waves-effect">
                                                       <i class="ri-attachment-fill"></i>
                                                    </button> 
                                            </li>
                                        </ul>

                                        <!-------Voice Recoder Controlls----->
                                        <ul class="list-inline mb-0" id="recoding-controll-container" style="display:none;">
                                            <li class="list-inline-item" data-toggle="tooltip" data-placement="top" title="" data-original-title="Emoji">
                                                <button type="button" class="btn btn-link text-decoration-none font-size-16 btn-lg waves-effect">
                                                    <i class="ri-close-fill" style="font-size: 32px;"></i>
                                                </button>
                                            </li>
                                            <li class="list-inline-item" id="recording_img"><img src="/assets/images/recording.gif" style="height: 30px;width: 30px;"/></li>
                                            <li class="list-inline-item" id="elsaps_time"></li> 

                                            <li class="list-inline-item" data-toggle="tooltip" data-placement="top" title="" data-original-title="Attached File">  
                                                <button type="button" class="btn btn-link text-decoration-none font-size-16 btn-lg waves-effect recording_done">
                                                    <i class="ri-chat-check-line" style="font-size: 32px;"></i>
                                                </button>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <!-- end chat input section -->
                    </div>
                    <!-- end chat conversation section -->
    
                    
                </div>
            </div>
            <!-- End User chat -->


            <!-- videocall Modal -->
            <div class="modal fade" id="videocallModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-body">
                            <div class="text-center p-4">
                                <div class="avatar-lg mx-auto mb-4">
                                    <img src="/assets/images/users/avatar-4.jpg" alt="" class="img-thumbnail rounded-circle">
                                </div>

                                <h5 class="text-truncate">Doris Brown</h5>
                                <p class="text-muted mb-0">Start Video Call</p>

                                <div class="mt-5">
                                    <ul class="list-inline mb-1">
                                        <li class="list-inline-item px-2">
                                            <button type="button" class="btn btn-danger avatar-sm rounded-circle" data-dismiss="modal">
                                                <span class="avatar-title bg-transparent font-size-20">
                                                    <i class="ri-close-fill"></i>
                                                </span>
                                            </button>
                                        </li>
                                        <li class="list-inline-item px-2">
                                            <input type="button" class="btn btn-success avatar-sm rounded-circle">
                                                <span class="avatar-title bg-transparent font-size-20">
                                                    <i class="ri-vidicon-fill"></i>
                                                </span>
                                            </button>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <!-- end modal -->
        </div>
        <!-- end  layout wrapper -->

        <!-- JAVASCRIPT -->
        <!--<script src="/assets/libs/jquery/jquery.min.js"></script>-->

        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <script src="/assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="/assets/libs/simplebar/simplebar.min.js"></script>
        
        <!--<script src="assets/libs/node-waves/waves.min.js"></script>-->

        <!-- Magnific Popup-->
        <!--<script src="assets/libs/magnific-popup/jquery.magnific-popup.min.js"></script>-->

        <!-- owl.carousel js -->
        <!---<script src="/assets/libs/owl.carousel/owl.carousel.min.js"></script>-->
        
        <!---<script src="/assets/js/pages/index.init.js"></script>
        <script src="/assets/js/app.js"></script>-->

        <script src="/assets/js/comman.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script src="/assets/js/clientSocket.js"></script>
        <script src="/assets/js/message.js"></script>
        

        <script src="/assets/js/emoji_js/inputEmoji.js"></script>

        <script>
            $(function () {
                $('.typing_box').emoji({listCSS: {
                    position:'absolute',
                    border:'1px solid gray',
                    top: '-253px'
                    }
                });
            })
        </script>
    </body>
</html>
